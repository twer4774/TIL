# FCM(Firebase 클라우드 메시징)

- 무료로 메시지를 안정적으로 전송할 수 이쓴ㄴ 교차 플랫폼 메시징 솔루션
- 새 이메일이나 기타 데이터를 동기화 할 수 있음을 클라이언트 앱에 알릴 수 있음
- 4KB의 페이로드를 클라이언트 앱에 전송 가능
- 주요기능
  - 알림 메시지 또는 데이터 메시지 전송
    - 사용자에게 표시되는 알림 메시지를 전송(알림메시지)
      - FCM이 클라이언트 앱을 대신하여 최종 사용자 기기에 자동으로 메시지를 표시
      - 알림 메시지에는 사용자에게 표시되는 사전 정의된 키 모음 및 맞춤 키-값 쌍의 데이터 페이로드(선택사항)가 포하됨
    - 데이터 메시지를 전송하고 애플리케이션 코드에서 임의로 처리(데이터 메시지)
      - 클라이언트 앱이 데이터 메시지 처리를 담당하
      - 데이터 메시지에는 맞춤 키-값 쌍만 존재
  - 다양한 메시지 타켓팅
    - 단일 기기, 기기 그룹, 주제를 구독한 기기 등 3가지 방식으로 클라이언트 앱에 메시지를 배포할 수 있음
  - 클라이언트 앱에서 메시지 전송
    - FCM의 신뢰성 높고 배터리 효율적인 연결 채널을 통해 기기에서 다시 서버로 확인, 채팅 및 기타 메시지를 보낼 수 있음

## 작동원리

1. Firebase용 Cloud 함수 또는 앱 서버와 같이 메시지를 작성, 타겟팅, 전송할 수있는 환경
2. 메시지를 수신하는 클라이언트앱(iOS, Android, Web)
   Admin SDK 또는 HTTP 및 XMPP API를 통해 메시지를 보낼 수 있음



### 알림 메시지

- 테스트, 마케팅, 사용자 재참여 유도를 위해 Firebase콘솔을 사용하여 알림 메시지전송 가능
- 프로그래매틱 방식으로 알림 메시지를 보내려면 notification 알림 메시지에서 사용자에게 표시되는 부분에 필요한 사전 정의된 키-값 옵션 모음으로 설정

```json
{
  "message":{
    "token":"bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1...",
    "notification":{
      "title":"Portugal vs. Denmark",
      "body":"great match!"
    }
  }
}
```

- 앱이 백그라운드 상태이면 알림 메시지가 알림 목록으로 전송
- 포그라운드 상태인 앱의 경우 다음 콜백이 메시지를 처리 함
- iOS에서는 didReceiveRemoteNotification:이 처리

### 데이터 메시지

- 맞춤 키-값 쌍으로 적절한 키를 설정하여 클라이언트 앱으로 데이터 페이로드를 보냄
- 정보는 공통 data 키에 캡슐화 되어 있고 클라이언트 앱이 콘텐츠를 해석함

```json
{
  "message":{
    "token":"bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1...",
    "data":{
      "Nick" : "Mario",
      "body" : "great match!",
      "Room" : "PortugalVSDenmark"
    }
  }
}
```
