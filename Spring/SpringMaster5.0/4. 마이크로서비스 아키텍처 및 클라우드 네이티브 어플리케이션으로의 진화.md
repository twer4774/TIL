# 4. 마이크로서비스 아키텍처 및 클라우드 네이티브 어플리케이션으로의 진화

## 스프링을 이용한 일반적인 웹 어플리케이션

- 웹 레이어 : 비즈니스로직을 노출하는 방법에 따라 나뉩니다.
  - 웹 어필르케이션 - HTML 뷰 렌더링
  - 스프링 MVC 또는 스트럿츠 같은 웹 MVC 프레임워크를 이용합니다.
  - RESTful 서비스
- 비즈니스 레이어
  - 어플리케이션의 모든 비즈니스 로직을 포함합니다.
  - 스프링 프레임워크는 빈을 연결하는데 비즈니스 레이어를 이용합낟.
  - 트랜잭션 관리의 경계가 시작되는 레이어이며, 트랜잭션은 AOP또는 AspectJ를 사용해 구현가능합니다.
- 데이터 레이어
  - JPA : DB테이블에 자바 객체 매핑
  - Hibernate: JPA의 구현체
  - 마이바티스 : 간단한 데이터 매핑 프레임워크
  - 스프링 JDBC : JDBC와 스프링 JDBC는 더 이상 일반적으로 사용되지 않습니다.
- 통합 레이어
  - 일반적으로 다른 어플리케이션과 통신하는 역할을 수행합니다.
  - HTTP(웹) 또는 MQ를 통해 SOAP 또는 RESTful 서비스를 제공하는 다른 어플리케이션이 있을 수 있습니다.
  - 스프링 JMS : 큐 또는 서비스에 메시지를 송수신하는데 이용합니다.
  - 스프링 MVC RestTemplate : RESTful 서비스를 호출합니다.
  - 스프링 WS : SOAP-기반 웹 서비스를 호출합니다.
  - 스프링 인티그레이션 : 엔터프라이즈 인티그레이션 솔루션을 위한 더 높은 레벨의 추상화를 제공합니다.
- 횡단관심(AOP)
  - 일반적인 공통 관심사
  - 로깅 : AOP를 사용해 여러 레이어에서 감사 로깅을 구현합니다.
  - 보안 : 스프링 시큐리티 프레임워크로 구현합니다.
  - 트랜잭션 관리 : 선언적 트랜잭션 관리, 일관된 추상화를 제공합니다.( JTA(Java Transaction API), JPA, JDBC 등)
  - 예외처리 : 대부분 unchecked 예외 처리로 구성되어 있습니다.

## 스프링에 의해 해결된 문제(EJB가 가진 문제들을 해결)

- 느슨한 결합 및 테스트 가능성 : DI/IoC
- 복잡한 코드 : 스프링 JDBC, 스프링 JMS 및 기타 추상화를 통해 비즈니스로직 작성에 집중할 수 있습니다.
- 경량 아키텍처 : 웹 프레임워크, 매핑 프레임워크를 다양하게 결합 가능합니다.
- 유연한 아키텍처 : 웹 프레임워크, 매핑 프레임워크로 다양하게 결합 가능합니다.
- 횡단관심의 구현 : Bean 중심으로 간편하게 구현가능합니다.
- 디자인 패턴의 사용
  - IoC/DI : 느슨한 결합
  - 싱글톤 : 모든 스프링 빈은 기본적으로 싱글톤으로 관리합니다.
  - 팩토리 패턴 : 빈 팩토리를 사용해 빈을 인스턴스화 합니다.
  - 프런트 컨트롤러 : 스프링 MVC는 DispatcherServlet을 프런트 컨트롤러로 사용합니다.
  - 템플릿 메소드 : JdbcTemplate, JmsTemplate 등을 이용합니다.

## 어플리케이션 개발 목표

- 속도 : 빠른 개발, 신속한 배포
- 안전
  - 신뢰성 : 얼마나 정확하게 가능한지
  - 가용성 : 24시간 내내 사용가능한지
  - 보안 : 인증 및 권한부여가 되는지
  - 성능 : 정해진 응답시간을 보장하는지
  - 높은 복원력 : 고장 및 중단될 경우 복원이 되는지
- 확장성

## 모놀리식 어플리케이션의 문제

- 특징 : 큰 크기, 대형팀, 의사소통의 갭, 자동화 테스트의 부족
- 문제
  - 긴 릴리즈 주기 : 테스트 자동화 부족과 사이드이펙트 해결을 위해 긴 시간 필요합니다.
  - 확장의 어려움 : 스케일 업, 다운등이 어렵습니다. 대형 데이터베이스의 병목현상이 발생할 수 있습니다.
  - 현대적인 개발사례를 적용 : TDD, BDD 같은 개발 방식의 사용이 어렵습니다.

## 마이크로 서비스 이해

### 마이크로 서비스란?

- 소규모 기능을 기반으로 독립적으로 배포할 수 있는 서비스 구축에 중점을 둔 아키텍처 스타일

### 특징

- 작고 가벼운 서비스 
  - 단일 책임 원칙을 따르기 때문에 크기가 작습니다.
  - 5분안에 빌드하고 배포 가능하도록 설계하는 것을 권장합니다.
- 메시지-기반 커뮤니케이션과 상호 운용성
- 용량 할당 마이크로 서비스 : 단일 식별 비즈니스 기능을 갖추고 있습니다.
- 독립적으로 배포 가능한 유닛으로 구성합니다.
- 무상태 : 요청간에 정보르 ㄹ저장하지 않습니다.
- 자동화된 빌드 및 릴리스 프로세스
- 이벤트-주도 아키텍처 : 모든 비즈니스로직에 중앙집중식 접점이 없습니다.
- 독립된 팀 구성이 가능합니다.

### 마이크로 서비스의 문제

- 자동화에 대한 필요성이 증대됩니다.
- 서브 시스템의 경계 정의를 명확히 해야합니다.
  - 느슨한 결합과 높은 응집도
  - 도메인의 나머지 역영에 어떤 기능을 제공하고 있는가
- 가시성 및 모니터링 : 자동화된 상태관리와 모니터링이 중요합니다.
- 내결함성
- 영속적 일관성 : 유사한 개발, 테스트, 릴리스, 배포 및 운영 프로세스가 가능하도록 설계해야 합니다.
- 공유기능(엔터프라이즈 개발)
  - 표준화가 필요합니다.
    - 하드웨어 : 어떤 하드웨어를 사용하는가? 클라우드인가?
    - 코드 관리 : 버전관리 시스템. branch 및 commit 코드의 관행
    - 빌드 및 배포 : 어떻게 빌드할까?
    - 데이터 리포지토리 : 어떤 종류의 데이터 리포지토리를 사용할까?
    - 서브스 오케스트레이션 : 서비스를 어떻게 조율하는가?
    - 보안 및 신원
    - 시스템 가시성 및 모니터링
- 운영팀에 대한 필요성이 증가합니다.

## 클라우드-네이티브 어플리케이션

### 12-팩터앱

- 클라우드-네이티브 어플리케이션 간의 일반적인 패턴 결합
- Heroku 엔지니어 경험에서 발전하여 앱은 배포할 수 있는 단일 유닛을 의미합니다.

### 특징

- 코드베이스 유지 : 각 앱은 버전관리에 하나의 코드-기반을 가집니다.
- 의존성 : 모든 의존성은 명시적으로 선언되고 분리되어야 합니다. 자바 어플리케이션에서는 Maven, Gradle 등 버전관리 도구를 사용합니다.
- 환경설정 : 여러 곳에서 환경설정에 대한 접근을 할 수 있으므로 관리가 필요합니다.
- 12-팩터앱: 중앙 집중식 리포지토리를 고려해야합니다.
- 백엔드 서비스 : 어플리케이션은 데이터 리포지토리 및 외부서비스 같은 다른 서비스를 사용할 수 있는지에 따라 달라집니다.
  - 12-팩터앱은 백엔드 서비스를 연결된 리소스로 취급합니다.
  - 백엔드 서비스는 일반적으로 외부 구성을 통해 선언됩니다.
- 빌드, 릴리스, 실행의 구분
  - 빌드 : 코드에서 실행할 수 있는 번들(war, jar)과 여러 환경에 배포할 수 있는 의존성을 만듭니다.
  - 릴리스 : 번들을 특정 환경설정과 결합해 환경에 배포합니다.
  - 실행 : 특정 릴리스를 사용해 실행환경에서 앱을 구동합니다.
- 무상태 : 필요한 모든 데이터는 영구 리포지토리에 저장합니다.
- 포트바인딩 : 포트바인딩을 이용해 모든 서비스를 제공합니다.
  - 앱 배포위치와 상관없이 메시지 수신 및 처리를 완벽하게 제어할 수 있습니다.
- 동시성 : 수평적 확장에 이용합니다.
- 처분 가능성 : 짧은 구동시간을 가지며, 정상적인 종료가 가능하고, 하드웨어 오류를 정상적으로 처리해야 합니다.
- 환경평가 : 개발, 테스트, 스테이징 및 프로덕션과 같은 모든 환경은 유사한 환경을 가질 수 있습니다.
- 이벤트 스트림 로그 : 모든 로그를 스트림으로 처리하면 뷰 및 보관을 위해 로그 스트림을 다른 대상으로 라우팅할 수 있습니다.
- 구분없는 어드민 프로세스 : 일반 어플리케이션 프로세스와 유사한 관리 태스크(마이그레이션, 스크립트)를 처리합니다.

## 스프링 프로젝트

### 스프링 부트

-  최소한의 설정으로 스프링-기반 프로젝트를 개발할 수 있습니다.

### 스프링 클라우드

- 클라우드에 시스템을 구축할 때 일반적으로 발생하는 패턴에 대한 솔루션을 제공합니다.
- 구성관리 : 스프링 크라우드 컨피드라는 마이크로서비르를 위한 중앙집중식 구성 관리 솔루션을 제공합니다.
- 서비스 발견 : 서비스간에 느슨한 결합을 촉진합니다.
  - 스프링 클라우드는 Eureka, Zookeeper, Console 같은 인기있는 서비스 디스커리버리 옵션과의 통합을 제공합니다.
  - 서킷 브레이커 : 내결함성. 넥플릭스 히스트릭스의 내결함성 라이브러리와의 통합을 제공합니다.
  - API Gateway : 중앙집중식 집계, 라우팅, 캐싱 서비스를 제공합니다. 넥플릭스 Zuul과의 통합을 제공합니다.