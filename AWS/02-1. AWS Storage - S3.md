#  02-1. AWS Storage - S3
- 객체 스토리지 
	- 객체란 문서, 이미지, 비디오 등 비교적 단순한 구조에 메타데이터를 포함하고 있는 데이터 조각
	- 인터넷으로 연결된 API를 통해 데이터를 어플리케이션에 제공한다.
- 블록 스토리지
	- 데이터란 서버 인스턴스에 디스크 볼륨 형태로 제공되는 데이터
	- EC2 인스턴스에 포함된 볼륨에 고속으로 접근할 수 있다.
	- EBS는 EC2 인스턴스를 위한 부트 볼륨 및 데이터베이스로 널리 사용된다.
- 파일 스토리지
	- 데이터란 서버 인스턴스에 파일 시스템 인터페이스 또는 파일 시스템 시맨틱스 방식으로 제공되는 데이터
	- EFS(Elastic File System)은 다수의 EC2를 통해 데이터에 접근이 가능하다.

## S3 ( Amazon Simple Storage Service)
- 저장 용량이 무제한이며, 지역별 재난 상황에 대처할 수 있도록 자동 복제 저장된다.
### 장점
- 간편성 : 웹 기반 콘솔 관리, REST API, SDK 제공
- 확장성 : 무제한으로 확장 가능
- 신뢰성 : 반복적으로 다수 Data Center와 스토리지 기기에 저장
- 보안성 : 모든 데이터는 암호화 업로드. SSL 전송을 지원한다.
- 고성능 : 멀티 파트 업로드 기능 지원. 지역별 네트워크 지연 최소화를 위해 인접 리전을 고객이 선택할 수 있도록 한다.
- 고가용성 : 99.99% 가용성을 지니도록 설계 되어있다.
- 저비용 : 옵션으로 접속횟수 제한, 반복 구현 제한, 글레이셔로 이전 등의 동작으로 비용을 절감할 수 있다.
- 관리 용이성 : 스토리지 최적화, 보안 및 관리 효율성 증대
- 연계성 : 다른 서드파티 도구와 연계

### 실무 활용법
- 데이터 백업 : 리전 내 여러 개의 AZ로 복제되어 관리하여 안전한 백업 가능
- 테이프 저장 장치 대체
- 재난 복구 : 크로스 리전 복제 전략
- 정적 웹 사이트 호스팅, 어플리케이션 호스팅
- 콘텐츠 배포 : 인터넷을 통한 콘텐츠 배포 방법으로 활용 가능하다.
	- 기업의 SW 제공 플랫폼으로 설계 가능하다.
- 데이터 레이크 : 기업에서 처리 분석, 소비되는 막대한 양의 데이터를 보관하는 중앙 저장소
	- 빅데이터 분석도구와 연계 사용 가능
- 프라이빗 저장소 : Git, Maven 같은 프라이빗 저장소로 구현 가능하다.

### S3 기념 개념
- 버킷의 목적
	- S3 네임 스페이스의 최상위 레벨
	- 비용을 부담하는 계쩡 표시
	- 액세스 컨트롤러에서 역할 수행
	- 사용당 보고서에서 누적 유닛 표시
- 메타데이터 : 키/벨류 쌍으로 표시. 최종 수정일, 파일 타입등 기록
- API 접근 : REST API 제공 (SOAP API - HTTPS Deprecated 예정)
- AWS CLI
	- 버킷 생성 : aws s3 mb s3://bucket-name
	- 버킷 제거 : aws s3 rb s3://bucket-name

### S3 데이터 일관성 모델
- 복수의 AZ에 LB, Web Server, Storage로 구성
- 신뢰성을 위해 아키텍처 중복 구성 가능
- 종국적 일관성 모델 (Evenvtually Consistent)
	- 데이터 자동복제 -> 즉각적으로 최신 내용이 업데이트 되지 않는다.
	- S3에 새 객체를 작성하자마자 읽기 시도 -> Key does not exist 메시지 반환
	- 기존 객체를 대체 후 바로 읽기 시도 -> 기존 데이터 반환
	=> AZ에 확산될 때 까지 딜레이 발생

### S3 성능 고려
- 초당 100회이상 Put/List/Delete 요청 또는 300회 이상 Get 요청이 필요하다면 워크로드를 적절히 파티셔닝하여 요청을 분산시켜야 한다.
- S3는 매우 높은 수준의 요청처리능력 제공
- Prefix 또는 키 전치사를 기준으로 저장위치를 파티셔닝한다.
	- Chatper 1, 2, 3 보다는 1Chapter, 2Chapter, 3Chapter로 파티셔닝을 하면 성능에 이점을 준다.
- 키 이름 문자열을 역순으로 배열하여 파티션 나누기
	- 어플리케이션 ID를 1씩 추가 되도록 설계되었다면, 어플리케이션 ID문자열을 역순으로 배열하여 파티셔닝한다.
- [효율적인방법] 키이름에 Hex Hash(16진수) 프리픽스 추가
	- MD5 해시알고리즘 이용
	- 2~3개의 프리픽스로 기업용이 커버 가능하다.

### S3 암호화
- 전송중인 Data 암호화 : 한 지점 -> 다른 지점
	- HTTPS 또는 SSL 암호화 종단점에서 Data를 upload하면 모든 upload/download Data를 자동으로 암호화하고, 암호화 상태를 유지한다.
	- S3 암호화 클라이언트를 이용해 버킷에 업로드전에 암호화한 경우, 전송 중에도 암호화가 유지된다.
- 저장된 Data 암호화 : S3 버킷에 저장돼 대기 상태인 데이터 암호화
	- SSE ( Server Side Encryption )
	- Data를 작성할 때 자동으로 암호화 하며, Data를 출력할 때 자동으로 복호화한다. ( AES 256 - 비트 대칭키 사용 )
	- SSE 키 관리 방식 3가지
		- S3 키 매니지먼트 기반의 SSE ( SSE - SE )
			- 객체별키는 마스터 키로 암호화 한다.
			- S3 키 매니지먼트를 통해 마스터 키를 관리하며, 마스터 키는 월 단위로 변경된다.
			- 사용자는 S3 콘솔, CMD, SDK 등으로 키 매니지먼트를 관리한다.
		- 고객 자체 생성키 기반의 SSE ( SSE - E )
			- 고객이 자체 생성한 커스텀 암호화 키로 데이터 암호화
			- 커스텀 키는 저장하지 않고 사용 즉시 삭제 한다.
		- AWS KMS 기반의 SSE ( SSE - KMS )
			- 마스터 키 사용 맥락에 따라 다양한 권한 설정 가능
			- S3 저장 객체에 대한 비승인 접근을 효과적으로 통제할 수 있는 추가 보안 데이터 제공

### S3 접근성 통제
- 접근 정책 : 유저, 그룹, 룰, IAM 정책
- ARN : Amazon Resource Name => arn:aws:s3:::bucket-name/key
- 버킷 정책 : 버킷 레벨에서 설정한 정책
	- Read only 정책으로 익명의 사용자 접근허용
		- principal : “*”
- 접근 제어 목록 ( ACL ) : 각 버킷과 객체에 ACL 매핑 -> 접근 정책 제어
	- S3에 붙여 사용 ex. Cloud Front CDN 연동시 ACL 사용

### S3 스토리지 클래스
- 아마존 S3 스탠다드
- 아마존 S3 스탠다드 IA : Infrequent Access
	- 접근 빈도가 상대적으로 낮은 데이터를 위한 클래스
- 아마존 S3 RRS : 반복 작업 감소 스토리지
	- 중요도가 낮고 기업 생산성과 직접적인 연관성이 낮은 데이터 보관
	- ex. 비디오 원본 파일은 스탠다드에 저장하고, 해상도별 (1080/720/360) 비디오는 RRS에 저장한다.
- 아마존 S3 One Zone-IA : 낮은 빈도 접근
	- 필요에 따라 빠른 접근이 가능하도록 변경 가능하다.
	- 단일 AZ에만 저장되며, 스탠다드 IA 보다 20% 저렴하다.
- 아마존 글레이셔 : 데이터 아카이브
	- 데이터 인출 옵션 (택 1)
		- 촉진 : 1~5분
		- 표준 : 3~5시간
		- 벌크 : 페타바이트 급 5~12시간
### 아마존 S3에서의 객체 버전 관리
- 버저닝으로 서로 다른 10가지 버전을 업로드 할 수 있다.
- GET : 기본 설정에 의해 최신 버전 파일을 가져오며, 이전 버전이 필요한 경우 세부적인 버전 정보를 추가 한다.
- 버저닝을 활성화하면 비활성화는 불가능하다. 단, 버저닝 작업을 중단할 수는 있다.

### 아마존 S3의 객체 라이프 사이클 관리
- 파일 이동 : 서로 다른 클래스 간 개체 이동 규칙 추가
	- ex. 로그 생성 -> 일주일 후 S3-IA로 이동
- 파일 소멸 : 객체 소멸 후의 사항 정의 가능
	- ex. S3에서 삭제 -> 일정 기간 별도 파일에 임시 저장

### 아마존 S3 크로스 리전 복제
- CRR ( Cross Region Replication ). S3 레플리카
- S3 버킷에 있는 개체를 자동으로 다른 리전에 복제 가능 ( 비동기 방식 )
- 소스 및 타깃 버킷에서 버저닝 기능이 활성화 돼 있어야 한다.
- Management 탭에서 Replication
- 옵션으로 다른 클래스의 S3에 복제 가능하다. ex. S3 스탠다드 -> S3-IA
- CRR은 동일 리전에 있는 서로 다른 버전 간의 복제 및 전송이 불가능하다.

### 아마존 S3에서 정적 웹사이트 호스팅
- S3에서는 서버측 스크립트를 지원하지 않는다. ( 동적 웹 사이트 - PHP, JSP )
- 정적 웹 사이트 호스팅
	- Bucket에서 Properties 메뉴 선택
	- Static Website Hosting 선택
	- Use This Bucket To Host -> Index.html 필수
	- 모든 사용자가 버킷에 접근할 수 있도록 정책 설정 필요
		- ex. S3:GetObject