# 4-9. ClassAndInterface - static

## static 멤버 클래스를 많이 사용하자

- 중첩 클래스(내부클래스)는 다른 클래스 내부에 정의된 클래스

  - 중첩 클래스는 외곽 클래스(Enclosing Class)를 지원하는 목적으로만 존재해야 함
  - 어떤 중첩 클래스가 일부 다른 분야나 클래스에서도 유용하게 사용된다면 그 클래스는 독립적인 최상위 클래스가 되어야 함

- 중첩 클래스의 종류

  - static 멤버 클래스 : 가장 간단한 종류의 중첩 클래스. 다른 클래스 내부에 선언되어 있고, 외곽 클래스의 모든 멤버들을 사용할 수 있는 일반적인 클래스

    - public 지원용도로 사용하며 외곽 클래스와 함께 사용할 때만 유용
      - 계산기에서 지원하는 연산을 나타내는 enum인 경우(Operation이 중첩클래스)
        - Claculator.Operation.PLUS와 같은 이름을 사용해서 연산
    - 중첩 클래스의 인스턴스가 외곽 클래스의 인스턴스와 완전 별개로 존재하려면 반드시 static 멤버 클래스가 되어야 함

  - static이 아닌 멤버 클래스

    - static이 아닌 멤버 클래스의 인스턴스와 그것의 외곽 이스턴스간의 관계는 static이 아닌 멤버 클래스의 인스턴스가 생성될 때 설정되므로 그 후로는 변경될 수 없음

    - 일반적으로 외곽 클래스의 인스턴스 메서드 내부로부터 static이 아닌 멤버 클래스의 생성자가 호출되면서 그 관계가 자동으로 설정됨

    - 사용용도

      - 어댑터 패턴을 구현할 때 쓰임. 이때 외곽 클래스의 인스턴스가 멤버 클래스와 관계없는 클래스의 인스턴스 처럼 보이게 할 수 있음
        - Map 인터페이스를 구현하는 클래스에서는 static이 아닌 멤버 클래스를 사용해서 자신의 컬렉션 뷰를 구현
      - Set이나 List와 같은 컬렉션 인터페이스를 구혀하는 클래스에서는 static이 아닌 멤버 클래스를 사용해서 자신들의 순환자(iterator)를 구현

      ```java
      //static이 아닌 멤버 클래스의 사용 예
      public class MySet<E> extends AbstractSet<E> {
        //이외의 다른 클래스 코드는 생략
        public Iterator<E> iterator(){
          return new MyIterator();
        }
        
        private class MyIterator implements Iterator<E>{
          ...
        }
      }
      ```

    - 만일 외곽 클래스의 인스턴스를 사용할 필요가 없는 멤버 클래스를 선언한다면, 항상 static 수식자를 선언부에 추가하여 static 멤버 클래스로 만들도록 해야함

      - static을 생략하면 메모리가 소요되며 가비지컬렉션의 대상이 됨

  - 익명 클래스 : 선언과 인스턴스 생성이 동시에 이루어짐. 표현식만 적합하다면 어디에서나 나올 수 있음

    - static이 아닌 상황에 있을 때만 외곽 클래스 인스턴스를 갖게 됨
    - 익명 클래스 사용의 제약
      - 선언된 곳에서만 인스턴스를 생성할 수 있음 => instanceof 연산자로 타입 검사를 할 수 없으며 클래스 이름이 필요한 곳에는 사용할 수 없음
    - 익명 클래스는 표현식이 중간에 나타나므로 가급적 코드가 짧아야 함
    - 사용용도
      - 함수객체를 생성하는데 많이 사용됨
        - sort메서드에서는 문자열의 길이를 기준을 String 객체를 저장한 배열을 정렬. 이때 익명 클래스인 Comparator의 인스턴스를 사용
      - Runnable, Trhead, TimeTask 등의 인스턴스와 같은 프로세스 객체를 생성하는데 많이 사용
      - static 팩토리 메서드 내부에서 사용

  - 지역 클래스 : 지역 변수가 선언될 수 있는 곳이면 어디든 선언될 수 있음

    - 멤버 클래스처럼 이름을 가질 수 있어 반복적으로 사용될 수 있음
    - static이 아닌 상황일 때에 한해서 익명 클래스처럼 외곽 인스턴스를 가지며 static 멤버를 포함할 수 없음

=> 중첩 클래스가 메서드 외부에 접근할 필요가 있거나 코드가 길면 멤버 클래스를 사용하자

=> 멤버 클래스의 각 인스턴스가 외곽 클래스의 인스턴스를 참조할 필요가 있다면 static이 아닌 멤버 클래스로 만들고, 그렇지 않다면 static으로 만듦

=> 어떤 메서드 내부에 속한다는 가정하에 한곳에서만 그 클래스의 인스턴스를 생성할 필요가 있고, 그 클래스의 특성을 나타내는 타입이 이미 존재한다면 익명클래스로 만들고 그렇지 않다면 지역 클래스로 만듦