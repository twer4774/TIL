# 시계열 데이터 수집하고 활용하기

- 시계열: 확률적 현상을 시간적으로 관측하여 얻은 값의 계열. 기상 현상·경제 동향 등의 통계 이론에 쓰임. 시간수열
- matplotlib: 수치해석 전용 SW인 MATLAB과 비슷한 인터페이스로 그래프를 그릴 수 있음
- FRED Economics Data에서 제공하는 환율 CSV 파일 이용
- pandas라는 데이터 처리 라이브러리 이용
- => pandas로 데이터 처리 후 matplotlib로 시각화

### 환율 데이터 수집

- https://fred.stlouisfed.org/series/DEXKOUS에서 기간 선택을 MAX 클릭 후 Dwonload(CSV)

- DEXKOUS.csv로 저장 => 주의: 중간에 환율이 비어있는 곳도 있음. 첫번째 열은 날짜, 두번째 열은 원 달러 환율

- pandas와 CSV파일

  - pandas: 데이터분석을 위한 데이터 구조와 도구를 제공하는 라이브러리

    - 내부적으로 NumPy라이브러리를 사용해 빠르게 동작함

    - ```
      pip3 install pandas
      ```

    - pandas에서 중요한 데이터 구조는 시리즈(Series)와 데이터프레임(DataFrame)

    ```python
    >>> import pandas as pd
    #Series 생성자에 list를 전달해 인스턴스 생성
    >>> s1=pd.Series([4, -2, 5])
    #표처럼 출력, 왼쪽: 인덱스, 오른쪽: 값
    >>> s1
    0    4
    1   -2
    2    5
    #마지막에 자료형 출력됨
    dtype: int64 
        
    >>> list(s1.index)
    [0, 1, 2]
    >>> list(s1.values)
    [4, -2, 5]
    
    #인덱스를 지정해서 시리즈 생성 가능
    >>> s2 = pd.Series([4, -2, 5], index=['a', 'b', 'c'])
    >>> s2
    a    4
    b   -2
    c    5
    dtype: int64
        
    >>> s2.index
    Index(['a', 'b', 'c'], dtype='object')
    >>> s2['c'] = 2
    >>> s2
    a    4
    b   -2
    c    2
    dtype: int64
    
    #딕셔너리 형식처럼 키로 레이블을 나타내고, 내부의 값은 시리즈 형식으로 다룸
    >>> df = pd.DataFrame({'math':[78, 64, 53], 'english': [45, 87, 67]}, index=['001', '002', '003'], columns=['math', 'english'])
    >>> df
         math  english
    001    78       45
    002    64       87
    003    53       67
    
    #dict처럼 [] 내부에 레이블 이름을 지정해서 열을 나타내는 시리즈를 추출
    >>> df['math']
    001    78
    002    64
    003    53
    Name: math, dtype: int64
    >>> df.english
    001    45
    002    87
    003    67
    Name: english, dtype: int64
            
            
    #ix 속성으로 인덱스 레이블을 지정하면 행을 추출 가능
    >>> df.ix['001']
    math       78
    english    45
    Name: 001, dtype: int64
    #ix 속성에 행 번호를 지정해도 행을 추출할 수 있음
    >>> df.ix[0]
    math       78
    english    45
    Name: 001, dtype: int64
            
    #열은 시리즈이므로 []를 사용해 내부의 값을 추출할 수 있음
    >>> df.english['001']
    45
    #describe() 메서드로 개수, 평균, 표준편차, 최소값, 백분위수, 최대값 등의 통계 출력
    >>> df.describe()
                math    english
    count   3.000000   3.000000
    mean   65.000000  66.333333
    std    12.529964  21.007935
    min    53.000000  45.000000
    25%    58.500000  56.000000
    50%    64.000000  67.000000
    75%    71.000000  77.000000
    max    78.000000  87.000000
    ```

  - CVS 파일 읽어 들이기

  ```python
  >>> import pandas as pd
  #read_csv() 함수의 첫 번째 매개변수에 파일경로, URL, 파일 객체 등 지정. read_csv()의 장점: 자료형 자동변환
  """
  그 밖의 매개변수
  encoding: 파일의 인코딩 지정
  hearder: 헤더로 사용할 줄 번호(0부터 시작)지정. 이 이전의 줄은 무시됨. None으로 지정시 맨 앞줄부터 데이터로 취급
  names: 열 이름 목록 지정
  skipinitialspace: True로 지정하면 구분문자(쉼표) 뒤에 이어지는 공백 무시
  index_col: 인덱스로 사용할 열의번호(0부터 시작) 지정
  parse_dates: True로 저징하면 인덱스에 사용할 열이 날짜일 경우 파싱. 날짜 형식은 알아서 추측
  date_parser: 날짜를 파싱할 함수를 지정
  na_values: NaN으로 간주할 문자열 목록 지정
  """
  >>> pd.read_csv('DEXKOUS.csv')
              DATE  DEXKOUS
  0     1981-04-13   675.40
  1     1981-04-14   676.70
  2     1981-04-15   676.70
  3     1981-04-16   676.70
  4     1981-04-17   676.75
  5     1981-04-20   676.70
  6     1981-04-21   676.70
  7     1981-04-22   676.70
  8     1981-04-23   676.70
  ```


### 엑셀 파일 읽기

- xlrd => .xls파일과 .xlsx파일을 모두 읽어 들임
- read_excel()함수를 사용하면 read_csv()함수처럼 데이터프레임을 반환
- 설치

```
pip3 install xlrd
```

- 연령별\_경제활동인구\_총괄\_구직기간\_1주 파일
- http://kosis.kr/statisticsList/statisticsListIndex.do?menuId=M_01_01&vwcd=MT_ZTITLE&parmTabId=M_01_01#SelectStatsBoxDiv => 다운로드 => gugik.xlsx라는 이름으로 저장

```python
>>> import pandas as pd

#read_excel()메서드로 엑셀파일 읽어 들임
>>> df_jobs = pd.read_excel("gugik.xlsx")
>>> df_jobs
          연령계층별      2017. 09    ...     2018. 09.6 2018. 09.7
0         연령계층별  15세이상인구 (천명)    ...        실업률 (%)    고용률 (%)
1             계         43987    ...            3.6       61.2
2      15 - 19세          2889    ...            5.9        7.1
3      20 - 29세          6366    ...              9       58.1
4   　　　20 - 24세          3010    ...           10.3       43.3
5   　　　25 - 29세          3356    ...            8.3       70.7
6      30 - 39세          7471    ...            3.6       75.6
7   　　　30 - 34세          3435    ...            4.4       75.5
8   　　　35 - 39세          4036    ...            2.9       75.6
9      40 - 49세          8523    ...            2.4       79.2
10  　　　40 - 44세          4026    ...            2.7       77.6

#stack() 함수로 행과 열을 바꿀 수 있음.
>>> df_jobs.stack()[7]
연령계층별         　　　30 - 34세
2017. 09             3435
2017. 09.1           2668
2017. 09.2           2573
2017. 09.3             95
2017. 09.4            767
2017. 09.5           77.7
2017. 09.6            3.6
2017. 09.7           74.9
2017. 10             3423

#index 속성으로 추출
>>>df_jobs.stack()[7].index
Index(['연령계층별', '2017. 09', '2017. 09.1', '2017. 09.2', '2017. 09.3',
       '2017. 09.4', '2017. 09.5', '2017. 09.6', '2017. 09.7', '2017. 10',
       ...
       '2018. 08.6', '2018. 08.7', '2018. 09', '2018. 09.1', '2018. 09.2',
       '2018. 09.3', '2018. 09.4', '2018. 09.5', '2018. 09.6', '2018. 09.7'],
      dtype='object', length=105)

#필요한 부분을 뽑아 리스트로 만듦
>>> ouput = []
>>> stacked = df_jobs.stack()[7]
>>> for index in stacked.index:
...     ouput.append([index, stacked[index]])
...
>>> ouput
[['연령계층별', '\u3000\u3000\u300030 - 34세'], ['2017. 09', 3435], ['2017. 09.1', 2668], ['2017. 09.2', 2573], ['2017. 09.3', 95], ['2017. 09.4', 767], ['2017. 09.5', 77.7], ['2017. 09.6', 3.6], ['2017. 09.7', 74.9], ['2017. 10', 3423], ['2017. 10.1', 2662], ['2017. 10.2', 2553], ['2017. 10.3', 109], ['2017. 10.4', 762], ['2017. 10.5', 77.8], ['2017. 10.6', 4.1], ['2017. 10.7', 74.6], ['2017. 11', 3411], ['2017. 11.1', 2662], ['2017. 11.2', 2565], ['2017. 11.3', 97], ['2017. 11.4', 749], ['2017. 11.5', 78], ['2017. 11.6', 3.7], ... ...
```

