# 유닉스 명령어로 스크레이핑

### 유닉스 명령어 기초 지식

- 표준 스트림

  - 표준 입력, 표준 출력, 표준 오류 출력
  - 리다이렉트: 표준 입력은 키보드에서의 입력, 표준 출력과 표준 오류 출력은 콘솔 출력인데, 이것을 파일에서의 입력 또는 파일에서의 출력 등으로 변경하는 것

- 파이프

  - 어떤 명령의 표준 출력을 다른 명령어의 표준 입력으로 전달하는 기능

  - echo | cut => |은 파이프 기호 (shift + \\)  
    echo: 단순한 문자열을 표준 출력으로 전달할 때 사용

    cut: 표준 입력에서 받은 문자열을 특정한 기호로 잘라 원하는 부분을 추출해 콘솔화면에 출력

    	cut \[option] \[file]

    option

    - -c 문자위치: 잘라낼 곳의 글자 위치를 지정한다. 콤마나 하이픈을 사용하여 범위 지정 가능
    - -f 필드: 잘라낼 필드를 정한다.
    - -d 구분자: 필드를 구분하는 문자를 지정, 디폴트는 탭 문자임
    - -s: 필드 구분자를 포함할 수 없다면 그 행은 하지 않는다.

    ```
    echo '1, 한빛미디어, 9788968488658, RxJava 프로그래밍' | cut -d , -f 4
    
    //위의 -d ,가 구분자임 ,를 구분자로 함  -f로 4번째 필드를 잘라냄
    //결과
    RxJava 프로그래밍
    ```

### 텍스트 처리와 관련된 유닉스 명령어

- cat: 매개변수로 전달된 파일을 출력

```
cat books.csv
```

- grep: 일부 줄만 추출할 때 사용. 매개변수로 지정한 문자열을 포함한 줄을 추출. 정규표현식으로 매개변수 지정 가능

```
//"파이썬" 문자열포함 줄만 추출
cat books.csv | grep 파이썬
```

- cut: 텍스트 일부를 제거할 때 사용

```
//,로 구분된 첫 번째 열과 두 번째 열만 출력. -d 옵션으로 구분할 문자, -f 옵션으로 열의 번호를 지정
cat books.csv | cut -d , -f 1,2
```

- sed: 특정 조건에 맞는 줄을 치환하거나 제거할 때 사용. s/<정규 표현식>/<치환할 문자>/<옵션> => <정규표현식>에 맞는 부분을 <치환할 문자열>로 치환해서 출력

```
//,를 공백으로 치환해서 출력. g 옵션은 한 줄에 해당 정규식이 여러번 출력될 경우 모두 치환
cat books.csv | sed 's/,/ / g'
```



### 정규 표현식(Regular Expression)

특정 패턴의 문자열을 나타내기 위한 문자열 표현

- POSIX의 기본 정규표현식(Basic Regular Expressions. BRE) 
- POSIX의 확장 정규 표현식(Extended Regular Expressions. ERE) => 기본 정규표현식에서 -E 옵션 추가
- Perl의 정규 표현식 => 가장 강력한 정규표현식

확장 정규 표현식과 Perl 정규 표현식에서 공통적으로 사용할 수 있는 주요 메타 문자

| 메타문자    | 설명                                                         |
| ----------- | ------------------------------------------------------------ |
| .           | 임의의 문자 하나를 나타냄. 예 "a.c" => aac, abc, acc         |
| []          | [] 내부 문자 중 하나와 매치. 예 "a[bc]d" => abd, acd         |
| [] 내부의 - | -로 문자의 범위 지정. 예 "[0-9]" => 0~9사이의 모든 숫자 형태의 문자와 매칭 |
| [] 내부의 ^ | ^를 앞에 붙이면 부정. 예 "\[^abc]" => a,b,c 이외의 문자와 매칭 |
| ^           | 줄의 시작. 예 "^abc" => 줄의 맨 앞에 있는 abc만 매치         |
| $           | 줄의 끝. 예 "xyz$" => 줄의 맨 끝에 있는 xyz만 매치           |
| *           | 직전의 패턴을 0번이상 반복. 예 "ab*c" => ac, abc, abbc, abbc 매치 |
| +           | 직전의 패턴을 1번 이상 반복. 예 "ab+c" => abc, abbc, abbbc 매치 |
| ?           | 직전의 패턴을 0번 또는 1번 반복. 예 "ab?c" => ac, abc 매치   |
| {n}         | 직전의 패턴을 지정한 n만큼 반복. 예 "ab{3}c" => abbbc        |
| ()          | ()로 감싼 패턴을 그룹으로 묶음. 예 "(ab)+" => ab, abab, ababab |
| \|          | \|로 구분된 패턴을 모두 매치. 예 "a(bc\|cd\|de)f" => abcf, acdf, adef |

```
//1로 시작하는 줄 찾기
cat books.csv | grep -E '^1'

//',.{4}원$' => ,(쉼표) 뒤에 임의의 문자 4개가 이어지고, "원"이 나온 뒤에 종료되는 줄을 찾음 => 1000원대 도서만 출력
cat books.csv | grep -E ',.{4}원$'
```



### 페이지 하나 출력하기

- 한빛 미디어 전체 도서 목록: http://www.hanbit.co.kr/store/books/full_book_list.html

```
wget http://www.hanbit.co.kr/store/books/full_book_list.html

//페이지 제목 => 오른쪽 클릭 => 검사
<a href="/store/books/look.php?p_code=B4559886540">리얼 블라디보스톡  PLUS 우수리스크 [2019~2020년 최신판]</a>

//추출 과정
//1. 파일 전체에서 "<td class="left"><a href="/store/books/look.php?p_code=<숫자>">와</a></td> 를 찾는다"
cat full_book_list.html | grep '<a href="/store/books/look.php'
//결과
<td class="left"><a href="/store/books/look.php?p_code=B9796997266">&#40;무료동영상&#41; 2019 전기산업기사 필기</a></td>
<td class="left"><a href="/store/books/look.php?p_code=B1401258166">&#40;무료동영상&#41; 2019 전기기사 필기</a></td>
<td class="left"><a href="/store/books/look.php?p_code=B4559886540">리얼 블라디보스톡  PLUS 우수리스크 [2019~2020년 최신판]</a></td>
<td class="left"><a href="/store/books/look.php?p_code=B1052483362">프라이드</a></td> ... ... 

//줄에서 원하는 문자열 위치 추출하기 => sed, cut, awk 명령어 이용
/*
추출 방법
1. sed명령어로 정규 표현식에 매치되는 부분 추출 => s\.*(<추출하고 싶은 위치의 정규표현식>).*/\1/
s/<A 위치>/<B 위치>/ => <A 위치> 내부에 ()를 입력하고 내부에 매치하고 싶으면 문자열입력, <B 위치>에 \1을 지정해 해당 그룹을 참조할 수 있게 함. () 앞 뒤로 *를 붙이면, 줄 전체를 의미하므로 \1로 한번만 출력으로 제한함

2. sed 명령어로 정규 표현식에 매치되는 부분을 제거하고, 남는 부분을 결과로 출력 
=> s/<제거하고 싶은 정규표현식>//g => g 옵션으로 정규표현식에 맞는 문자열 여러번 나오면 모두 실행(제거)
HTML태그 부분을 제거하거나 요소의 내용을 추출할 때 자주 사용됨

echo '<td class="left"><a href="/store/books/look.php?p_code=B4559886540">리얼 블라디보스톡  PLUS 우수리스크 [2019~2020년 최신판]</a></td>' | sed -E 's/<[^>]*>//g'

//결과
리얼 블라디보스톡  PLUS 우수리스크 [2019~2020년 최신판]

3. cut 명령어로 특정 문자열로 자른 후 n번째 데이터 추출 => ,(쉼표)로 구분한 문자열에서 4번째 데이터 추출
echo '1, 한빛미디어, 9788968488658, RxJava 프로그래밍, 종이책,2017-09-04' | cut -d , -f 4
//RxJAva 프로그래밍

4. awk 명령어로 공백 구분하고 n번째 데이터 추출 => cut은 구분문자를 하나밖에 지정 불가- 공백으로 구분된 구분문자가 연속하는 경우에는 awk가 적합함(awk는 공백으로 구분된 경우에만 좋음) => {print $n} : n번째 문자 출력
echo 'PID 	COMMAND 	%CPU TIME	#TH	 #WQ	#PORT MEM' | awk '{print $4}'
//TIME
*/


//2. 추출한 데이터를 다듬고 리스트에 넣은 뒤 출력한다.
//2번 방법으로 추출 => <>태그 제거, 앞에 생기는 공백제거, &#40;, &#41; 문자 제거 순으로 매개변수 넣음
cat full_book_list.html | grep '<a href="/store/books/look.php?p_code=' | sed -E 's/<[^>]*>//g' | sed -E 's/^\s*//' | sed -E 's/&#40;/\(/g' | sed -E 's/&#41;/\)/g'

(무료동영상) 2019 전기산업기사 필기
(무료동영상) 2019 전기기사 필기
리얼 블라디보스톡  PLUS 우수리스크 [2019~2020년 최신판]
프라이드
퇴근길 인문학 수업 : 전진
만화로 배우는 곤충의 진화
맥 쓰는 사람들의 macOS 모하비
IT CookBook, 쉽게 배우는 JSP 웹 프로그래밍
처음 시작하는 R 데이터 분석
NCS를 기반으로 한 직무 기초수학
데이터 과학을 위한 통계
오준석의 안드로이드 생존코딩(코틀린 편)
처음 배우는 스프링 부트 2
퇴근길 인문학 수업 : 전환



```

